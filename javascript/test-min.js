"use strict";const mis="missed id: ";var debug=e=>{"object"==typeof e&&(e=JSON.stringify(e)),window.console.log(e)},$$=e=>document.getElementById(e),$n=e=>document.getElementsByName(e)[0],$=e=>$$(e)?$$(e):$n(e),$sbg=(e,l)=>{e?e.style.backgroundColor=l:debug(mis+e)},$sc=(e,l)=>{$(e)?$(e).style.color=l:debug(mis+e)},$sd=(e,l,o="block")=>{$(e)?($(e).classList.remove("hidden"),$(e).style.display=l?o:"none"):debug(mis+e)},$tt=e=>{if($(e))return $(e).innerText;debug(mis+e)},$h=(e,l)=>{$(e)?$(e).innerHTML=l:debug(mis+e)},$v=(e,l)=>{$(e)?$(e).value=l:debug(mis+e)},$ch=(e,l)=>{$(e)?$(e).checked=!l||"true"!=l.toString()&&1!=l?"":"checked":debug(mis+e)},$qs=e=>document.querySelectorAll(e),$parent=(e,l)=>l&&e?$parent(e.parentNode,--l):e;Object.keys||(Object.keys=e=>{var l=[];for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&l.push(o);return l});const full_view_pixel=3,full_view_brk=1,tipDuration="5000";var full_view_lcd,CustomSymbolsPanel,symbol_code,selectedMenu,ToolTipText,init_complite=!1,copiedPanelConfig="",panels_config={},panels_obj={},menuItems=["about","cps","custom_symbol","config","tests"],elSavedState=[{name:"full_view_cp",defvalue:"eu"},{name:"rows",defvalue:2},{name:"columns",defvalue:16},{name:"px_size",defvalue:3},{name:"break_size",defvalue:1},{name:"lcd_bg_color",defvalue:"#cd2"},{name:"lcd_pixel_color",defvalue:"#143"},{name:"lcd_border"},{name:"lcd_large"},{name:"symbols_data_type"},{name:"lcd_bus"},{name:"code_gen"},{name:"show_hover_grid"}],ToolTip=(e,l,o)=>{if(l&&(l=" alert-"+l),e=e.replace("%v",o),ToolTipText!=e){var a=document.createElement("div");a.className="alert"+l,a.innerHTML=e,ToolTipText=e,$("ohsnap").appendChild(a);var n=e=>{e&&e.remove(),ToolTipText=""};a.onclick=()=>{n(a)},setTimeout((()=>{n(a)}),"5000")}},getPanelIndex=e=>e?"card test_panel"==e.className?e.id.replace("lcd_",""):getPanelIndex(e.parentNode):null,selMenu=e=>{menuItems.forEach((e=>{$sd(e,0),$ch("m_"+e,0)})),selectedMenu=e,$ch("m_"+e,1),$sd(e,1),saveState(e)},selStndLCDSize=e=>{var l=e.split("x");$("rows").value=l[0],$("columns").value=l[1],$("px_size").value=l[2]},selLCDColors=()=>{full_view_lcd.setBGColor($("lcd_bg_color").value),CustomSymbolsPanel.setBGColor($("lcd_bg_color").value),full_view_lcd.setPixelsColor($("lcd_pixel_color").value),CustomSymbolsPanel.setPixelsColor($("lcd_pixel_color").value),$("custom_symb_matrix").style.backgroundColor=$("lcd_bg_color").value,$qs("label[class='dot-px']").forEach((e=>{e.style.backgroundColor&&(e.style.backgroundColor=$("lcd_pixel_color").value)}))},selFullViewCP=()=>{full_view_lcd=new CharLCD({at:"full_view_lcd",rows:16,cols:16,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_pixel_color").value,pixel_size:3,break_size:1,show_hover_grid:$("show_hover_grid").checked?1:0});for(let e=0;e<16;e++)for(let l=0;l<16;l++)full_view_lcd.char(e,l,String.fromCharCode(16*e+l));$("custom_symb_matrix").style.backgroundColor=$("lcd_bg_color").value,full_view_lcd.param.font=CustomSymbolsPanel.param.font;for(let e=0;e<8;e++)full_view_lcd.char(0,e,String.fromCharCode(e))},initFullViews=()=>{var e=new CharLCD({at:"lcd0",rows:1,cols:1,off:"#fff",on:"#f00",pixel_size:3,break_size:1});e.font(0,[0,10,21,17,10,4]),e.char(0,0,String.fromCharCode(0)),new CharLCD({at:"lcd1",rows:1,cols:16,off:"#fff",on:"#000",pixel_size:3,break_size:1}).text(0,0,"0123456789ABCDEF"),new CharLCD({at:"lcdv",rows:16,cols:1,off:"#fff",on:"#000",pixel_size:3,break_size:1}).text(0,0,"0\n1\n2\n3\n4\n5\n6\n7\n8\n9\nA\nB\nC\nD\nE\nF"),selFullViewCP()},createNewPanel=e=>{let l=new CharLCD(e);e.content&&l.text(0,0,e.content),panels_obj[e.id]=l,$sbg($("panel_"+e.id).parentNode,e.border?"#000":"#fff")},setPanelInfoText=e=>{let l="ROM: "+e.rom;l+=", rows="+e.rows,l+=", cols="+e.cols,l+="<br/>pixel size="+e.pixel_size,l+=", break size="+e.break_size,l+=e.large?", Large LCD":"",$("panel_info_"+e.id).innerHTML=l},addPanel=e=>{if(!e){let l=Object.keys(panels_config).length;e={id:l,at:"panel_"+l,name:"Panel "+(parseInt(l)+1),minimized:0,rows:$("rows").value,cols:$("columns").value,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_pixel_color").value,pixel_size:$("px_size").value,break_size:$("break_size").value,show_hover_grid:$("show_hover_grid").checked?1:0,large:$("lcd_large").checked,border:$("lcd_border").checked,content:""}}let l=document.createElement("div");l.className="card test_panel",l.id="lcd_"+e.id,l.innerHTML=$("panel_template").innerHTML.replace("{text}",e.content).replace("{PanelName}",e.name).replace(/{id}/g,e.id),$("panels").appendChild(l),panels_config[e.id]=e,createNewPanel(e),e.minimized&&collapsePanel($("min_panel_"+e.id)),setPanelInfoText(e),savePanelsState(),$(l.id).scrollIntoView(),$("text_"+e.id).focus()},updatePanel=e=>{let l=getPanelIndex(e),o=e.value;panels_obj[l].text(0,0,o),panels_config[l].content=o},copyPanelConfig=(e,l)=>{"global"==e?(copiedPanelConfig={rows:$("rows").value,cols:$("columns").value,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_pixel_color").value,pixel_size:$("px_size").value,break_size:$("break_size").value,large:$("lcd_large").checked,border:$("lcd_border").checked,show_hover_grid:$("show_hover_grid").checked?1:0},ToolTip("Global settings saved at inner variable.<br />You can past it to test panels config","green")):"CustomSymbol"==e?(symbol_code=CustomSymbolsPanel.getSymbolByIndex($("currentSymbolIndex").value),ToolTip("Custom symbol saved at inner variable","green")):"config"==e&&(copiedPanelConfig=panels_config[getPanelIndex(l)],ToolTip("Panel config saved at inner variable.<br />Past it to other panel config or gloabal settings page","green"))},pastPanelConfig=(e,l,o)=>{if("global"==e){if("string"!=typeof copiedPanelConfig.rom)return void ToolTip("Error: empty config","red");$v("rows",copiedPanelConfig.rows),$v("columns",copiedPanelConfig.cols),$v("full_view_cp",copiedPanelConfig.rom),$v("lcd_bg_color",copiedPanelConfig.off),$v("lcd_pixel_color",copiedPanelConfig.on),$v("px_size",copiedPanelConfig.pixel_size),$v("break_size",copiedPanelConfig.break_size),$ch("lcd_large",copiedPanelConfig.large),$ch("lcd_border",copiedPanelConfig.border),$ch("show_hover_grid",copiedPanelConfig.show_hover_grid),$v("lcd_sizes",copiedPanelConfig.rows+"x"+copiedPanelConfig.cols+"x"+copiedPanelConfig.pixel_size),ToolTip("Global settings replaced with saved","yellow")}else if("CustomSymbol"==e){if(!o){if(!symbol_code&&init_complite)return void ToolTip("Error: empty symbol code","red");o=symbol_code}for(let e=0;e<8;e++)dec2bin(o[e]).split("").reduce(((l,o,a)=>{$("dot"+(5*e+a-1)).checked="1"==o}));updateCustomSymb()}else if("panel"==e){if("string"!=typeof copiedPanelConfig.rom)return void ToolTip("Error: empty config","red");let e=getPanelIndex(l);copiedPanelConfig.id=e,copiedPanelConfig.at="panel_"+e,copiedPanelConfig.content=panels_config[e].content,copiedPanelConfig.name||(copiedPanelConfig.name=panels_config[e].name),panels_config[e]=copiedPanelConfig,createNewPanel(copiedPanelConfig),setPanelInfoText(copiedPanelConfig),ToolTip("Panel config replaced with saved","yellow")}},editPanelName=e=>{let l=getPanelIndex(e);e.parentNode.innerHTML="<input type='text' onfocusout='renamePanel(this)' id='panel_name_"+l+"' value='"+e.innerHTML+"'/>";let o=$("panel_name_"+l);o.focus(),o.selectionStart=o.value.length},renamePanel=e=>{let l=getPanelIndex(e),o=e.value;e.parentNode.innerHTML='<h3 id="panel_name_'+l+'" onclick="editPanelName(this, '+l+')">'+o+"</h3>",panels_config[l].name=o},collapsePanel=e=>{let l=getPanelIndex(e);"_"==e.innerText?($sd("panel_area_"+l,0),panels_config[l].minimized=1,e.innerText="â–¡"):($sd("panel_area_"+l,1),panels_config[l].minimized=0,e.innerText="_")},delPanel=e=>{let l=getPanelIndex(e);confirm('Realy delete panel "'+$("panel_name_"+l).innerHTML+'"?')&&(ToolTip('"'+$("panel_name_"+l).innerHTML+'" R.I.P....',"blue"),$("lcd_"+l).remove(),delete panels_obj[l],delete panels_config[l],savePanelsState())},saveState=e=>{init_complite&&(elSavedState.forEach((e=>{"checkbox"==$(e.name).type?localStorage.setItem("LCDtest_"+e.name,$(e.name).checked):localStorage.setItem("LCDtest_"+e.name,$(e.name).value)})),e&&localStorage.setItem("LCDtest_SelPage",e))},loadState=()=>{selMenu(localStorage.getItem("LCDtest_SelPage")||"about"),elSavedState.forEach((e=>{"checkbox"==$(e.name).type?$ch(e.name,localStorage.getItem("LCDtest_"+e.name)):$v(e.name,localStorage.getItem("LCDtest_"+e.name)||e.defvalue);var l=$(e.name).onchange;$(e.name).onchange=()=>{"function"==typeof l&&l(),saveState()}})),$v("lcd_sizes",$("rows").value+"x"+$("columns").value+"x"+$("px_size").value),$("lcd_sizes").value||$v("lcd_sizes","---")},savePanelsState=()=>{init_complite&&localStorage.setItem("LCDtest_Panels_config",JSON.stringify(panels_config))},initPanels=()=>{let e=JSON.parse(localStorage.getItem("LCDtest_Panels_config"));if(!e||0==Object.keys(e).length)return void addPanel({id:0,at:"panel_0",name:"Panel 1",minimized:0,rows:2,cols:16,rom:"eu",off:"#D5D9E0",on:"#143",pixel_size:3,break_size:1,show_hover_grid:$("show_hover_grid").checked?1:0,large:0,border:1,content:"Test LCD Display\nEmulator HD44780"});let l=0;Object.keys(e).forEach((o=>{e[o].id=l,e[o].at="panel_"+l,addPanel(e[o]),l++}))},initCustomSymbolMatrix=()=>{var e=$("custom_symb_matrix");e.style.backgroundColor=$("lcd_bg_color").value,e.style.display="block";for(let l=0;l<8;l++){let o=document.createElement("div");o.className="row";for(let e=0;e<5;e++){let a="dot"+(e+5*l),n=document.createElement("label");n.className="dot-px",n.setAttribute("for",a);let t=document.createElement("input");t.type="checkbox",t.id=a,t.onchange=()=>{updateCustomSymb()},o.appendChild(t),o.appendChild(n)}e.appendChild(o)}},initCustomSymbolsPanel=()=>{CustomSymbolsPanel=new CharLCD({at:"custom_symbols_panel",rows:1,cols:8,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_pixel_color").value,pixel_size:3,break_size:1,show_hover_grid:$("show_hover_grid").checked?1:0});let e=JSON.parse(localStorage.getItem("LCDtest_CustomSymbolsFont")||"[]");CustomSymbolsPanel.param.font=e;for(let l=0;l<e.length;l++)e[l]&&null!=e[l]&&CustomSymbolsPanel.char(0,l,String.fromCharCode(l))},initSwipes=()=>{document.addEventListener("touchstart",o,!1),document.addEventListener("touchmove",a,!1);var e=null,l=null,o=o=>{const a=(e=>e.touches||e.originalEvent.touches)(o)[0];e=a.clientX,l=a.clientY},a=o=>{if(e&&l){var a=e-o.touches[0].clientX,n=l-o.touches[0].clientY;Math.abs(a),Math.abs(n),e=null,l=null}}},selSymbol=e=>{let l=e=>{$("currentSymbolIndex").value=e;let l=CustomSymbolsPanel.getSymbolByIndex(e,!0);l||null!=l||(l=[]),pastPanelConfig("CustomSymbol",null,l)};if("selCustomSymbolIndex"==e)return void l($("currentSymbolIndex").value);var o=$qs("ul:hover");if(!(o=o[o.length-1]))return;let a=o.style,n=parseInt((parseInt(a.left)-1)/24),t=16*parseInt((parseInt(a.top)-1)/36)+n;"cps"==e?(symbol_code=full_view_lcd.getSymbolByIndex(t),ToolTip("Symbol config copyed. You can past it in custom symbol generator page","green")):(e="custom_sym")&&l(t)},clearCustomPanel=()=>{if(window.confirm("Clear all custom symbols?")){CustomSymbolsPanel.param.font=[],full_view_lcd.param.font=[];for(let e=0;e<8;e++)CustomSymbolsPanel.set(0,e),full_view_lcd.set(0,e)}},allOffCustomSymb=()=>{for(let e=0;e<40;e++)$("dot"+e).checked="";updateCustomSymb()},allOnCustomSymb=()=>{for(let e=0;e<40;e++)$("dot"+e).checked="checked";updateCustomSymb()},invertCustomSymb=()=>{for(let e=0;e<40;e++)$("dot"+e).checked=""==$("dot"+e).checked?"checked":"";updateCustomSymb()},updateCustomSymb=()=>{$qs("input+[class='dot-px']").forEach((e=>{e.style.backgroundColor=""})),$qs("input:checked+[class='dot-px']").forEach((e=>{e.style.backgroundColor=$("lcd_pixel_color").value}));let e=$("code_gen").checked,l=$("code_arduino_tempalte").innerText;e&&(l=l.replace(/\{columns\}/g,$("columns").value),l=l.replace(/\{rows\}/g,$("rows").value),l=$("lcd_bus").checked?l.replace(/{I2C_bus}(.|\n)*?{\/I2C_bus}/g,"").replace(/({parallel_bus}|{\/parallel_bus})/g,""):l.replace(/{parallel_bus}(.|\n)*?{\/parallel_bus}/g,"").replace(/({I2C_bus}|{\/I2C_bus})/g,""));let o="",a="[";for(let e=0;e<40;e++)o+=$("dot"+e).checked?"1":"0",5==o.length&&(a+=bin2dec(o),e<35&&(a+=","),o="");a+="]";let n=$("currentSymbolIndex").value;CustomSymbolsPanel.font(n,JSON.parse(a)),CustomSymbolsPanel.char(0,n,String.fromCharCode(n));let t="",s="";const r=/(?<={customCharArrays})(.|\n)*(?={\/customCharArrays})/g.exec(l)[0],i=/(?<={loadChar})(.|\n)*(?={\/loadChar})/g.exec(l)[0];let c=0,d=$("symbols_data_type").value;CustomSymbolsPanel.param.font.forEach((l=>{if(0==c||l&&"[0,0,0,0,0,0,0,0]"!=JSON.stringify(l)){var o=Array(8);for(let e=0;e<8;e++)o[e]="bin"==d?"0b"+dec2bin(l[e]):"hex"==d?"0x"+dec2hex(l[e]):l[e];let a=JSON.stringify(o).replace(/(\[|\]|\")/g,""),n=r.replace("{char_index}",c);t+="bin"==d?n.replace("{symbol_data}","\n\t\t\t"+a.replace(/,/g,",\n\t\t\t")+"\n"):n.replace("{symbol_data}",a+" "),e&&(s+=i.replace(/{char_index}/g,c)),c++}})),e?(l=l.replace("{chars_count}",c),l=l.replace(/({loadChar}(.|\n)*{\/loadChar})/g,s),l=l.replace(/({customCharArrays}(.|\n)*{\/customCharArrays})/g,t)):l=t,$("custom_sym_code").innerHTML=Prism.highlight(l,Prism.languages.cpp,"cpp"),localStorage.setItem("LCDtest_CustomSymbolsFont",JSON.stringify(CustomSymbolsPanel.param.font)),$sd("div_code",1)},bin2hex=e=>e.match(/.{4}/g).reduce(((e,l)=>e+parseInt(l,2).toString(16)),""),hex2bin=e=>e.split("").reduce(((e,l)=>e+parseInt(l,16).toString(2)),""),dec2bin=e=>{let l="00000"+Number(e).toString(2);return l.substring(l.length-6)},bin2dec=e=>parseInt(e,2),dec2hex=e=>e.toString(16);window.addEventListener("DOMContentLoaded",(()=>{loadState(),initPanels(),initCustomSymbolMatrix(),initCustomSymbolsPanel(),initFullViews(),selSymbol("selCustomSymbolIndex"),setInterval(savePanelsState,5e3),init_complite=!0}));