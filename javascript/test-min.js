const mis="missed id: ";var debug=e=>{window.console.log(e)},$$=e=>document.getElementById(e),$n=e=>document.getElementsByName(e)[0],$=e=>$$(e)?$$(e):$n(e),$sbg=(e,a)=>{e?e.style.backgroundColor=a:debug(mis+e)},$sc=(e,a)=>{$(e)?$(e).style.color=a:debug(mis+e)},$sd=(e,a,l="block")=>{$(e)?$(e).style.display=a?l:"none":debug(mis+e)},$tt=e=>{if($(e))return $(e).innerText;debug(mis+e)},$h=(e,a)=>{$(e)?$(e).innerHTML=a:debug(mis+e)},$v=(e,a)=>{$(e)?$(e).value=a:debug(mis+e)},$ch=(e,a)=>{$(e)?$(e).checked=!a||"true"!=a.toString()&&1!=a?"":"checked":debug(mis+e)},$qs=e=>document.querySelectorAll(e),$parent=(e,a)=>a&&e?$parent(e.parentNode,--a):e;Object.keys||(Object.keys=e=>{var a,l=[];for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&l.push(a);return l});const panel_markup='<div>\n\t<span class="r">\n\t\t<h3 onclick="editPanelName(this)" id="panel_name_{id}">{PanelName}</h3>\n\t</span>\n\t<span class="l">\n\t\t<input type=\'button\' value=\'▼\' onclick=\'pastPanelConfig(this)\'\n\t\ttitle="Past panel config" />\n\t\t<input type=\'button\' value=\'▲\' onclick=\'copyPanelConfig(this)\'\n\t\ttitle="Copy panel config" />\n\t\t<input type=\'button\' value=\'_\' onclick=\'collapsePanel(this)\'\n\t\ttitle="Collapse panel" />\n\t\t<input type=\'button\' value=\'X\' onclick=\'delPanel(this)\'\n\t\ttitle="Delete panel" />\n\t</span>\n</div>\n<div class="block" id="panel_area_{id}"> \n\t<div>\n\t\t<textarea rows="2" cols="16" class="panel_row" onkeyup="updatePanel(this)">{text}</textarea>\n\t</div> \n\t<span class="r"></span>\n\t<span class="lcd_border">\n\t\t<div id="panel_{id}"></div>\n\t</span>\n\t<span class="l"></span>\n</div>',full_view_pixel=3,full_view_brk=1;var copiedPanelConfig="",panels_config={},panels_obj={},getPanelIndex=e=>e?"card test_panel"==e.className?e.id.replace("lcd_",""):getPanelIndex(e.parentNode):null,selMenu=e=>{["full_page","global_settings","tests"].forEach((e=>{$sd(e,0),$ch("m_"+e,0)})),$ch("m_"+e,1),$sd(e,1),saveState(e)},selStndLCDSize=e=>{var a=e.split("x");$("rows").value=a[0],$("columns").value=a[1],$("px_size").value=a[2],saveState()},selFullViewCP=()=>{$h("full_view_lcd","");for(var e=new CharLCD({at:"full_view_lcd",rows:16,cols:16,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_text_color").value,pixel_size:3,break_size:1}),a=0;a<16;a++)for(var l=0;l<16;l++)e.char(a,l,String.fromCharCode(16*a+l));saveState()},initFullViews=()=>{var e=new CharLCD({at:"lcd0",rows:1,cols:1,off:"#fff",on:"#f00",pixel_size:3,break_size:1});e.font(0,[0,10,21,17,10,4]),e.char(0,0,String.fromCharCode(0)),new CharLCD({at:"lcd1",rows:1,cols:16,off:"#fff",on:"#000",pixel_size:3,break_size:1}).text(0,0,"0123456789ABCDEF"),new CharLCD({at:"lcdv",rows:16,cols:1,off:"#fff",on:"#000",pixel_size:3,break_size:1}).text(0,0,"0\n1\n2\n3\n4\n5\n6\n7\n8\n9\nA\nB\nC\nD\nE\nF"),selFullViewCP()},addPanel=e=>{if(!e){let a=Object.keys(panels_obj).length;e={id:a,at:"panel_"+a,name:"Panel "+(parseInt(a)+1),minimized:0,rows:$("rows").value,cols:$("columns").value,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_text_color").value,pixel_size:$("px_size").value,break_size:$("break_size").value,large:$("lcd_large").checked,content:""}}let a=document.createElement("div");a.className="card test_panel",a.id="lcd_"+e.id,a.innerHTML=panel_markup.replace("{text}",e.content).replace("{PanelName}",e.name).replace(/{id}/g,e.id),$("panels").appendChild(a),$sbg($("panel_"+e.id).parentNode,$("lcd_border").checked?"#000":"#fff");var l=$("panel_name_"+e.id).innerHTML;panels_config[e.id]={name:l,panel_config:e};let n=new CharLCD(e);e.content&&n.text(0,0,e.content),panels_obj[e.id]=n,e.minimized&&$sd("panel_area_"+id,0)},updatePanel=e=>{let a=getPanelIndex(e),l=e.value;panels_obj[a].text(0,0,l+"  "),panels_config[a].panel_config.content=l},initPanels=()=>{localStorage.getItem("LCDtest_Panels_config")},copyPanelConfig=e=>{if("global"==e){let e={rows:$("rows").value,cols:$("columns").value,rom:$("full_view_cp").value,off:$("lcd_bg_color").value,on:$("lcd_text_color").value,pixel_size:$("px_size").value,break_size:$("break_size").value,large:$("lcd_large").checked};copiedPanelConfig=e,alert("Global settings saved at inner variable. You can past it to test panels config.")}else{let a=getPanelIndex(e);if(!a)return;copiedPanelConfig=panels_config[a].panel_config,alert("Panel config saved at inner variable. Past it to other panel config or gloabal settings.")}},editPanelName=e=>{let a=getPanelIndex(e);e.parentNode.innerHTML="<input type='text' onfocusout='renamePanel(this)' id='panel_name_"+a+"' value='"+e.innerHTML+"'/>";let l=$("panel_name_"+a);l.focus(),l.selectionStart=l.value.length},renamePanel=e=>{let a=getPanelIndex(e),l=e.value;e.parentNode.innerHTML='<h3 id="panel_name_'+a+'" onclick="editPanelName(this, '+a+')">'+l+"</h3>",panels_config[a].name=l},collapsePanel=e=>{let a=getPanelIndex(e);"_"==e.value?($sd("panel_area_"+a,0),panels_config[a].minimized=1,e.value="□"):($sd("panel_area_"+a,1),panels_config[a].minimized=0,e.value="_")},delPanel=e=>{let a=getPanelIndex(e);confirm('Realy delete panel "'+$("panel_name_"+a).innerHTML+'"?')&&($("lcd_"+a).remove(),delete panels_obj[a],delete panels_config[a])},elSavedState=[{name:"full_view_cp",defvalue:"eu"},{name:"rows",defvalue:2},{name:"columns",defvalue:16},{name:"px_size",defvalue:3},{name:"break_size",defvalue:1},{name:"lcd_bg_color",defvalue:"#cd2"},{name:"lcd_text_color",defvalue:"#143"},{name:"lcd_border"},{name:"lcd_large"}],saveState=e=>{elSavedState.forEach((e=>{"checkbox"==$(e.name).type?localStorage.setItem("LCDtest_"+e.name,$(e.name).checked):localStorage.setItem("LCDtest_"+e.name,$(e.name).value)})),e&&localStorage.setItem("SelPage",e)},loadState=()=>{elSavedState.forEach((e=>{"checkbox"==$(e.name).type?$ch(e.name,localStorage.getItem("LCDtest_"+e.name)):$v(e.name,localStorage.getItem("LCDtest_"+e.name)||e.defvalue)})),$("lcd_sizes").value=$("rows").value+"x"+$("columns").value+"x"+$("px_size").value,selMenu(localStorage.getItem("SelPage")||"full_page")},savePanelsState=()=>{localStorage.setItem("LCDtest_Panels_config",JSON.stringify(panels_config))},loadPanelsState=()=>{};window.addEventListener("DOMContentLoaded",(()=>{loadState(),initFullViews(),initPanels(),addPanel({id:0,at:"panel_0",name:"Panel 1",minimized:0,rows:2,cols:16,rom:"eu",off:"#D5D9E0",on:"#143",pixel_size:3,break_size:1,large:0,content:"Test LCD Display\nEmulator HD44780"}),setInterval(savePanelsState,5e3)}));